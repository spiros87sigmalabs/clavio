{
  "version": 3,
  "sources": ["../../../../Desktop/stream-build-main/netlify/functions/publish-project.js"],
  "sourceRoot": "C:/Users/user/AppData/Local/Temp/tmp-14792-8Zm752Bt6BDE",
  "sourcesContent": ["const fs = require('fs');\r\nconst path = require('path');\r\n\r\nconst projectsDir = path.join(process.cwd(), 'public', 'projects');\r\nif (!fs.existsSync(projectsDir)) {\r\n  fs.mkdirSync(projectsDir, { recursive: true });\r\n}\r\n\r\nconst headers = {\r\n  'Access-Control-Allow-Origin': '*',\r\n  'Access-Control-Allow-Headers': 'Content-Type, Accept',\r\n  'Access-Control-Allow-Methods': 'POST, OPTIONS',\r\n  'Access-Control-Max-Age': '86400',\r\n};\r\n\r\nexports.handler = async (event) => {\r\n  if (event.httpMethod === 'OPTIONS') {\r\n    return { statusCode: 200, headers, body: '' };\r\n  }\r\n\r\n  if (event.httpMethod !== 'POST') {\r\n    return {\r\n      statusCode: 405,\r\n      headers,\r\n      body: JSON.stringify({ error: 'Method not allowed' }),\r\n    };\r\n  }\r\n\r\n  try {\r\n    if (!event.body) {\r\n      return {\r\n        statusCode: 400,\r\n        headers,\r\n        body: JSON.stringify({ error: 'No body provided' }),\r\n      };\r\n    }\r\n\r\n    const { html_content, project_name, project_id } = JSON.parse(event.body);\r\n\r\n    if (!html_content || !project_name) {\r\n      return {\r\n        statusCode: 400,\r\n        headers,\r\n        body: JSON.stringify({ error: 'Missing html_content or project_name' }),\r\n      };\r\n    }\r\n\r\n    // \u0394\u03B7\u03BC\u03B9\u03BF\u03C5\u03C1\u03B3\u03AF\u03B1 \u03C6\u03B9\u03BB\u03B9\u03BA\u03BF\u03CD \u03BF\u03BD\u03CC\u03BC\u03B1\u03C4\u03BF\u03C2 \u03B1\u03C1\u03C7\u03B5\u03AF\u03BF\u03C5\r\n    const friendlyName = project_name\r\n      .toLowerCase()\r\n      .replace(/[^a-z0-9\u03B1-\u03C9\u03AC-\u03CE]/g, '-')\r\n      .replace(/-+/g, '-')\r\n      .replace(/^-|-$/g, '');\r\n    \r\n    const id = project_id || Date.now().toString(36) + Math.random().toString(36).substr(2, 6);\r\n    const filename = `${friendlyName}-${id}.html`;\r\n    const filePath = path.join(projectsDir, filename);\r\n    \r\n    fs.writeFileSync(filePath, html_content);\r\n\r\n    // \u0394\u03B7\u03BC\u03B9\u03BF\u03C5\u03C1\u03B3\u03AF\u03B1 clean URL\r\n    const siteUrl = process.env.URL || 'http://localhost:8888';\r\n    const publicUrl = `${siteUrl}/projects/${filename}`;\r\n\r\n    return {\r\n      statusCode: 200,\r\n      headers: {\r\n        ...headers,\r\n        'Content-Type': 'application/json',\r\n      },\r\n      body: JSON.stringify({\r\n        id,\r\n        project_name,\r\n        public_url: publicUrl,\r\n        message: project_id ? 'Project updated successfully!' : 'Project published successfully!',\r\n        action: project_id ? 'updated' : 'created',\r\n      }),\r\n    };\r\n  } catch (error) {\r\n    console.error('\u274C Error:', error);\r\n    return {\r\n      statusCode: 500,\r\n      headers,\r\n      body: JSON.stringify({ error: 'Internal server error: ' + error.message }),\r\n    };\r\n  }\r\n};"],
  "mappings": ";AAAA,IAAM,KAAK,QAAQ,IAAI;AACvB,IAAM,OAAO,QAAQ,MAAM;AAE3B,IAAM,cAAc,KAAK,KAAK,QAAQ,IAAI,GAAG,UAAU,UAAU;AACjE,IAAI,CAAC,GAAG,WAAW,WAAW,GAAG;AAC/B,KAAG,UAAU,aAAa,EAAE,WAAW,KAAK,CAAC;AAC/C;AAEA,IAAM,UAAU;AAAA,EACd,+BAA+B;AAAA,EAC/B,gCAAgC;AAAA,EAChC,gCAAgC;AAAA,EAChC,0BAA0B;AAC5B;AAEA,QAAQ,UAAU,OAAO,UAAU;AACjC,MAAI,MAAM,eAAe,WAAW;AAClC,WAAO,EAAE,YAAY,KAAK,SAAS,MAAM,GAAG;AAAA,EAC9C;AAEA,MAAI,MAAM,eAAe,QAAQ;AAC/B,WAAO;AAAA,MACL,YAAY;AAAA,MACZ;AAAA,MACA,MAAM,KAAK,UAAU,EAAE,OAAO,qBAAqB,CAAC;AAAA,IACtD;AAAA,EACF;AAEA,MAAI;AACF,QAAI,CAAC,MAAM,MAAM;AACf,aAAO;AAAA,QACL,YAAY;AAAA,QACZ;AAAA,QACA,MAAM,KAAK,UAAU,EAAE,OAAO,mBAAmB,CAAC;AAAA,MACpD;AAAA,IACF;AAEA,UAAM,EAAE,cAAc,cAAc,WAAW,IAAI,KAAK,MAAM,MAAM,IAAI;AAExE,QAAI,CAAC,gBAAgB,CAAC,cAAc;AAClC,aAAO;AAAA,QACL,YAAY;AAAA,QACZ;AAAA,QACA,MAAM,KAAK,UAAU,EAAE,OAAO,uCAAuC,CAAC;AAAA,MACxE;AAAA,IACF;AAGA,UAAM,eAAe,aAClB,YAAY,EACZ,QAAQ,oBAAoB,GAAG,EAC/B,QAAQ,OAAO,GAAG,EAClB,QAAQ,UAAU,EAAE;AAEvB,UAAM,KAAK,cAAc,KAAK,IAAI,EAAE,SAAS,EAAE,IAAI,KAAK,OAAO,EAAE,SAAS,EAAE,EAAE,OAAO,GAAG,CAAC;AACzF,UAAM,WAAW,GAAG,YAAY,IAAI,EAAE;AACtC,UAAM,WAAW,KAAK,KAAK,aAAa,QAAQ;AAEhD,OAAG,cAAc,UAAU,YAAY;AAGvC,UAAM,UAAU,QAAQ,IAAI,OAAO;AACnC,UAAM,YAAY,GAAG,OAAO,aAAa,QAAQ;AAEjD,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS;AAAA,QACP,GAAG;AAAA,QACH,gBAAgB;AAAA,MAClB;AAAA,MACA,MAAM,KAAK,UAAU;AAAA,QACnB;AAAA,QACA;AAAA,QACA,YAAY;AAAA,QACZ,SAAS,aAAa,kCAAkC;AAAA,QACxD,QAAQ,aAAa,YAAY;AAAA,MACnC,CAAC;AAAA,IACH;AAAA,EACF,SAAS,OAAO;AACd,YAAQ,MAAM,iBAAY,KAAK;AAC/B,WAAO;AAAA,MACL,YAAY;AAAA,MACZ;AAAA,MACA,MAAM,KAAK,UAAU,EAAE,OAAO,4BAA4B,MAAM,QAAQ,CAAC;AAAA,IAC3E;AAAA,EACF;AACF;",
  "names": []
}
